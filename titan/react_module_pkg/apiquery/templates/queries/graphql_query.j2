{% magic_with res.fun_name as getRedRose %}
import { normalize, schema } from 'normalizr';
import { useQuery } from 'react-query';
import { useQueryData } from 'src/api/components';
import { doQuery } from 'src/utils/graphqlClient';
import { ObjT } from 'src/utils/types';
{% for field_spec in _.fk_output_field_specs %}
import { {{ field_spec.target }} } from 'src/api/schema';
{% endfor %}

export const {{ _.output_schema_name }} = new schema.Entity('{{ _.output_schema_name }}');
{{ sections.query_output_schema_fields() }}

const getRedRose = ({{ sections.javascript_args() }}) => {
  return doQuery(
    `query {{ res.name }}{{ sections.ts_graphql_query_args(True) }} {
{% for output_field_spec in res.outputs_type_spec.field_specs %}
        {{ output_field_spec.name }}{{ sections.ts_graphql_query_args(False) }} {
{{ sections.ts_graphql_query_body(output_field_spec) }}
        }
{% endfor %}
    }`,
    {
{{ sections.graphql_variables() }}
    }).then(
    (response: ObjT) => {
      return normalize(response, {{ _.output_schema_name }}).entities;
    });
}

export const useGetRedRose = ({{ sections.javascript_args() }}) => {
  const query = useQuery(
    ['getRedRose',
    {{ sections.use_javascript_args() }}],
    () => getRedRose({{ sections.use_javascript_args() }})
  );
  return useQueryData(query);
};
{% end_magic_with %}