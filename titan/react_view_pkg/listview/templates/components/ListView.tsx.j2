{% magic_with _.component.item_name as fooItem %}
{% magic_with _.component.name as FooListView %}
{% magic_with _.component.module.name as myReactModule %}
{% magic_with field_name as redRose %}
import { cn } from 'src/utils/classnames';
import * as R from 'ramda';
import { observer } from 'mobx-react-lite';
import { withDefaultProps } from 'react-default-props-context';
import { FooItemListViewItem } from 'src/myReactModule/components';
import { FooItemT } from 'src/api/types/FooItemT';
import { getResourceView } from 'src/utils/components';

import { Deletion } from 'skandha-facets/Deletion';                                             {% ?? __.deletion_bvr %}
import { Highlight } from 'skandha-facets/Highlight';                                           {% ?? __.highlight_bvr %}
import { Selection } from 'skandha-facets/Selection';                                           {% if __.selection_bvr %}
import { ClickToSelectItems } from 'skandha-facets/handlers';                                   {% endif %}

import './FooItemListView.scss';

type PropsT = {
  className?: any;
};

type DefaultPropsT = {
  fooItems: FooItemT[],
  fooItemsRS: string,
  fooItemsDeletion: Deletion,                                                                   {% ?? __.deletion_bvr %}
  fooItemsHighlight: Highlight,                                                                 {% ?? __.highlight_bvr %}
  fooItemsSelection: Selection,                                                                 {% ?? __.selection_bvr %}
};

export const FooListView = observer(
  withDefaultProps<PropsT, DefaultPropsT>((props: PropsT & DefaultPropsT) => {
    const resourceView =
      props.fooItemsRS === 'loading' ? <div /> : undefined;
    if (resourceView) return resourceView;

    const handleClick = new ClickToSelectItems({                                                {% if __.selection_bvr %}
      selection: props.fooItemsSelection
    });                                                                                         {% endif %}

    const fooItemDivs = R.pipe(
      R.always(props.fooItems),
      R.map((fooItem: FooItemT) => {
        return (
          <FooListViewItem
            key={fooItem.id}
            fooItem={fooItem}
            isSelected={fooItem && props.fooItemsSelection.ids.includes(fooItem.id)}            {% ?? __.selection_bvr %}
            isHighlighted={fooItem && props.fooItemsHighlight.id === fooItem.id}                {% ?? __.selection_bvr %}
            onDelete={() => props.fooItemsDeletion.delete([fooItem.id])}                        {% ?? __.deletion_bvr %}
            {...handleClick.handle(fooItem.id)}                                                 {% ?? __.selection_bvr %}
          />
        );
      })
    )();

    const noItems = <h2>There are no fooItems</h2>;

    return (
      <div
        className={cn(
          'FooItemListView', 'flex flex-col',
          props.className
        )}
      >
        {fooItemDivs.length > 0 && fooItemDivs}
        {fooItemDivs.length === 0 && noItems}
      </div>
    );
  })
);
{% end_magic_with %}
{% end_magic_with %}
{% end_magic_with %}
{% end_magic_with %}
