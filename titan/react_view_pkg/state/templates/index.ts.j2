{% magic_with container.name as myContainer %}
{% magic_with bvr.name as myBvr %}
{% magic_with _.state.name as MyState %}
{% magic_with container.item_name as myItem %}
import { setCallbacks } from 'aspiration';
import { makeObservable } from 'mobx';
import { addCleanUpFunctionToCtr, cleanUpCtr } from 'react-default-props-context';
import * as Skandha from 'skandha';
import { ClassMemberT as CMT, facet, getm } from 'skandha';
import { registerCtr } from 'skandha-mobx';
import { getIds } from 'src/utils/ids';
import * as Facets from 'skandha-facets';
import { Selection, SelectionCbs, handleSelectItem } from 'skandha-facets/Selection';                   {% ?? __.has_bvr("selection") %}
import { Highlight, HighlightCbs } from 'skandha-facets/Highlight';                                     {% ?? __.has_bvr("highlight") %}
import { Filtering, FilteringCbs } from 'skandha-facets/Filtering';                                     {% ?? __.has_bvr("filtering") %}
import { Deletion, DeletionCbs } from 'skandha-facets/Deletion';                                        {% ?? __.has_bvr("deletion") %}

export type PropsT = {
  deleteFoobars: (ids: string[]) => Promise;                                                            {% for container in __.containers %}{% ?? container.get_bvr("deletion") %}{% endfor %}
};

export class MyState {
  myContainer = {                                                                                       {% for container in __.containers %}
    data: new MyContainerData(),
    myBvr: new MyBvr(),                                                                                 {% for bvr in container.bvrs %}{% endfor %}
  }                                                                                                     {% endfor %}

  _myContainerMapData(props: PropsT) {                                                                  {% for container in __.containers %}
    const getMyItemById = (x?: string) =>                                                               {% if container.get_bvr("selection") or container.get_bvr("highlight") %}
      x ? this.myContainer.data.myItemById[x] : undefined;                                              {% endif %}

    mapDataToProps(
      [                                                                                                 {% if container.get_bvr("selection") %}
        [this.myContainer.selection, 'selectableIds'],
        () => getIds(this.myContainer.data.myItemsDisplay),
      ],
      [
        [this.myContainer.selection, 'items'],
        () => this.myContainer.selection.ids.map(getMyItemById),
      ],                                                                                                {% endif %}
      [                                                                                                 {% if container.get_bvr("highlight") %}
        [this.myContainer.highlight, 'item'],
        () => getMyItemById(this.myContainer.highlight.id),
      ],                                                                                                {% endif %}
      [
        [this.myContainer.data, 'myItemsDisplay'],
        () => this.myContainer.data.myItems,                                                            {% ?? not container.get_bvr("filtering") %}
        () => this.myContainer.filtering.filteredItems,                                                 {% ?? container.get_bvr("filtering") %}
      ],
    )
  }                                                                                                     {% endfor %}

  getSummary() {
    return {
      myContainer: Skandha.getCtrState(this.myContainer),                                               {% !! container in __.containers %}
    }
  }

  destroy() {
    cleanUpCtr(this);
  }

  constructor(props: PropsT) {
    registerCtr({                                                                                       {% for container in __.containers %}
      ctr: this.myContainer,
      options: { name: 'MyState.MyContainer' },
      initCtr: () => {
        initMyContainer(this, props);
        this._myContainerMapData(props);
      },
    });                                                                                                 {% endfor %}
  }
}
{% end_magic_with %}
{% end_magic_with %}
{% end_magic_with %}
{% end_magic_with %}
